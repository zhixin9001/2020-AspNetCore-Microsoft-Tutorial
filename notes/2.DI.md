
ASP.NET Core提供了默认的依赖注入容器，可以在Startup.ConfigureServices方法中进行服务注入的配置。

### 服务的生命周期
默认的依赖注入容器提供了三种生命周期：
- 暂时（AddTransient），每次在向服务容器进行请求时都会创建新的实例，这种生存期适合轻量级、 无状态的服务。
- 范围内（AddScoped），为每个客户端请求创建一次实例。
- 单例（AddSingleton），第一次请求时（或者在运行Startup.ConfigureServices 并且使用服务注册指定实例时）创建，每个后续请求都使用相同的实例。如果应用需要单例行为，建议允许服务容器管理服务的生存期。 不要再自己实现单例设计模式。

下面试验一下这三种方式的差异：
注入配置：
```
services.AddSingleton<ISingletonTest, SingletonTest>();
services.AddTransient<ITransientTest, TransientTest>();
services.AddScoped<IScopedTest, ScopedTest>();

services.AddTransient<ScopeAndTransientTester>();
```

控制器：
```
public DefaultController(ISingletonTest singleton, ITransientTest transient, IScopedTest scoped, ScopeAndTransientTester scopeAndTransientTester
    )
{
    this.singleton = singleton;
    this.transient = transient;
    this.scoped = scoped;
    this.scopeAndTransientTester = scopeAndTransientTester;
}

[HttpGet]
public string Get()
{
    return $"singleton={singleton.guid}; \r\nscoped1={scoped.guid};\r\nscoped2={scopeAndTransientTester.ScopedID()};\r\ntransient={transient.guid};\r\ntransient2={scopeAndTransientTester.TransientID()};";
}
```
用于第二次注入的ScopeAndTransientTester类：
```
public class ScopeAndTransientTester
{
    public ISingletonTest singleton { get; }
    public ITransientTest transient { get; }
    public IScopedTest scoped { get; }

    public ScopeAndTransientTester(ISingletonTest singleton, ITransientTest transient, IScopedTest scoped)
    {
        this.singleton = singleton;
        this.transient = transient;
        this.scoped = scoped;
    }

    public Guid SingletonID()
    {
        return singleton.guid;
    }
    public Guid TransientID()
    {
        return transient.guid;
    }
    public Guid ScopedID()
    {
        return scoped.guid;
    }
}
```
第一次请求：
```
singleton=ebece97f-bd38-431c-9fa0-d8af0419dcff; 
scoped1=426eb574-8f34-4bd3-80b3-c62366fd4c74;
scoped2=426eb574-8f34-4bd3-80b3-c62366fd4c74;
transient=98f0da06-ba8e-4254-8812-efc19931edaa;
transient2=c19482f7-1eec-4b97-8cb2-2f66937854c4;
```
第二次请求：
```
singleton=ebece97f-bd38-431c-9fa0-d8af0419dcff; 
scoped1=f5397c05-a418-4f92-8c6d-78c2c8359bb5;
scoped2=f5397c05-a418-4f92-8c6d-78c2c8359bb5;
transient=59ed30fa-609b-46b1-8499-93a95ecd330b;
transient2=d2a8ea1c-ae0b-4732-b0a1-ca186897e676;
```

用Guid来表示不同的实例。对比两次请求可见AddSingleton方式的id值相同；AddScope方式两次请求之间不同，但同一请求内是相同的；AddTransient方式在同一请求内的多次注入间都不相同。

### TryAdd
另外还有TryAdd{Lifetime}方式，如果只希望在同类型的服务尚未注册时才添加服务，可以使用这种方法。如果直接使用Add{Liffetime}，则每次多次重复注册。
### 